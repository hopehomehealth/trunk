define("cal4pro",["jquery","moment"],function(d,v,a){function w(f){f.sort();for(var e=[f[0]],c=1;c<f.length;c++){f[c]!==e[e.length-1]&&e.push(f[c])}return e}function j(y){var s=[],u={},o,f=null,x=[],e;for(o in y){y.hasOwnProperty(o)&&b.test(o)&&(e=q(o,"YYYYMMDD").startOf("month").valueOf(),s.push(e),m.test(y[o])&&(f?parseFloat(f)-parseFloat(y[o])>0&&(f=y[o]):f=y[o],x.push(parseFloat(y[o]))))}return u.hasProMonth=w(s),u.lowestPrice=f,u.isUniqPrice=k.unique(x).length==1,u}var k=d("jquery"),q=d("moment"),m=(q(),/[1-9]+(\.\d+)*|0(\.\d*[1-9]+\d*)+/),b=/\d{4}-\d{2}-\d{2}/i,p='<div class="cal4pro" id="calcPrice" style="width:534px">          <div class="cal4_oper">            <p class="full_date"><span class="year"></span>\u5e74<span class="month"></span>\u6708</p>            <span id="pro-calc-prev" class="m_prev"></span>            <span id="pro-calc-today" class="c_today">\u56de\u4eca\u5929</span>            <span id="pro-calc-next" class="m_next "></span>          </div>          <table  class="tbl_week">            <tr><th>\u661f\u671f\u4e00</th><th>\u661f\u671f\u4e8c</th><th>\u661f\u671f\u4e09</th>              <th>\u661f\u671f\u56db</th><th>\u661f\u671f\u4e94</th><th class="weekend">\u661f\u671f\u516d</th><th class="weekend last">\u661f\u671f\u65e5</th></tr>          </table>          <table  class="tbl_con">          </table>        </div>',g=function(f){function h(G){var y=G,C=y.day(),E=y.clone().endOf("month"),F=E.date(),D=C+F,l="",B=D>36?42:35;for(i=0;B>i;i++){i&&0==i%7&&(l+="</tr><tr>"),l+=(i+1)==C?u(y):(i+1)>C&&D>(i+1)?u(y.add(1,"days")):"<td></td>"}return"<tr>"+l+"</tr>"}function u(L){var C=L.format("YYYY-MM-DD"),n="",D="",E="",H="",G="",B="",y="",M=0,F,J,I,K;return F=C==q().format("YYYY-MM-DD"),J=f.holiday.indexOf(C)>-1,K=f.proInfo[C]==f.lowestPrice,I=k.isFunction(f.buildLink)&&f.buildLink.call(null,f.proInfo.id,C,F,K,J)||"",f.proInfo&&f.proInfo[C]&&(m.test(f.proInfo[C])?(M=1,E='<span class="c_price"><i>&yen;'+f.proInfo[C]+"</i>\u8d77</span>"):E+='<span class="c_price">\u5df2\u552e\u5b8c</span>'),F&&(D='<span class="date today">\u4eca\u5929</span>'),H=F?"":('<span class="date">'+L.date()+"</span>"),G=J?'<i class="ui-icon-cal festival">&nbsp;</i>':"",1==M&&K&&!f.isUniqPrice&&(B='<i class="ui-icon-cal low">&nbsp;</i>'),y+=D+H+G+B+E,1==M?handleDateStr=n='<td date-click="true"><a target="_blank" data-date="'+C+'" href="'+I+'">'+y+"</a></td>":n="<td><div>"+y+"</div></td>",n}function x(n){var l=isRightBtnClick=isTodayBtnClick=!1,s=q(parseInt(f.hasProMonth[0])),y=q(parseInt(f.hasProMonth.slice(-1)));return n.isAfter(s)&&(l=!0),n.isBefore(y)&&(isRightBtnClick=!0),q().startOf("month").isSame(n)||(isTodayBtnClick=!0),{isLeftBtnClick:l,isRightBtnClick:isRightBtnClick,isTodayBtnClick:isTodayBtnClick}}function o(l,n){n.isLeftBtnClick?l.find(".m_prev").unbind("click").bind("click",function(){A(c.clone().subtract("months",1));f.btnClick.call(this,z)}).removeClass("prev_n").addClass("prev_y"):l.find(".m_prev").unbind("click").removeClass("prev_y").addClass("prev_n");n.isRightBtnClick?l.find(".m_next").unbind("click").bind("click",function(){A(c.clone().add(1,"months"));f.btnClick.call(this,z)}).removeClass("next_n").addClass("next_y"):l.find(".m_next").unbind("click").removeClass("next_y").addClass("next_n");n.isTodayBtnClick&&l.find(".c_today").unbind("click").bind("click",function(){A(q().startOf("month"));f.btnClick.call(this,z)})}function A(n){var l=x(n),r;o(z,l);body=h(n.clone());c=n;z.find("p .year").html(n.year());z.find("p .month").html(n.month()+1);z.find("table.tbl_con").html(body);r=z.find("table tr td[date-click] span.c_lowest");z.find("td[date-click] a").click(function(s){f.proClick.call(this,z,s)})}function e(l){return x(l),h(l.clone()),z=k(p),A(l),z}var z=null,c=null;return f=k.extend({startDate:null,proInfo:{},maxProNum:10,btnClick:k.noop,proClick:k.noop,holiday:[],buildLink:k.noop},f||{}),c=b.test(f.startDate)&&q(f.startDate,"YYYYMMDD").startOf("month"),k.extend(f,j(f.proInfo)),e(c?c:q(parseInt(f.hasProMonth[0])))};a.exports=g});