define(function(require,exports,module){var e=require("jquery");require("handlebars");var t='{{#each gradeRecordList}}<dl class="comment-row">'+"<dt>"+'<div class="uhead"></div>'+'<div style="overflow:hidden; text-overflow:ellipsis;">{{customerName}}</div>'+'<div class="uname">&nbsp;&nbsp;&nbsp;&nbsp;</div>'+"</dt>"+"<dd>"+'<i class="icon ico-smile"></i>'+'<div class="line-height">{{tranRemark remark}}</div>'+'<div class="font12 gray-c mt10">{{tranScore trafficScore guideScore hotelScore buyProcessScore journeyScore}} </div>'+'<div class="font12 gray-c mt10">{{createDate}} </div>'+"</dd>"+"</dl>{{/each}}"+'<div class="pagination mt30">'+"{{#with Count}}共{{TotalPage}}页"+'<span class="{{isDisable Page 1}} prePage">&lt; 上一页</span>'+"{{{printPage Page TotalPage 5}}}"+'<span title="下一页"  class="{{isDisable Page TotalPage}} nextPage">下一页 &gt;</span>'+'到<div class="pagination_gopage_wrap">'+'<input data-cur="{{Page}}" data-total="{{TotalPage}}"  type="text"  class="pagination_btn_go_input"> 页'+'<input type="button" value="确定" class="pagination_btn_go">{{/with}}</div>',a=Handlebars.compile(t),n=e("#score-template").html(),r=Handlebars.compile(n);Handlebars.registerHelper("tranScore",function(e,t,a,n,r){var i=["(不满意)","(一般)","(一般)","(满意)","(满意)","(满意)"];return"行程 "+" "+i[r]+"    导游 "+" "+i[t]+"    交通 "+" "+i[e]+"    住宿 "+" "+i[a]+"    购买流程 "+" "+i[n]});Handlebars.registerHelper("tranRemark",function(e){if(!e)return" ";return e.length<150?e:e.substring(0,150)+"..."});Handlebars.registerHelper("tranStar",function(e){var t=parseInt(e);if(t-e===0)return e;return t+"x"});Handlebars.registerHelper("printPage",function(e,t,a){function n(e,t,a){var n=[],r=parseInt(a/2);if(e<0||t<=0||a<=0||e>t)return n;if(e<r){for(var i=1;i<=t&&i<a+1;i++){n.push(i)}return n}if(e+r>=t){for(var i=0;i<=a&&t-i>=1;i++){n.unshift(t-i)}return n}for(var i=1;i<a+1;i++){n.push(e+i-r)}return n}var r=n(e,t,a);var i="";for(var s=0;s<r.length;s++){if(r[s]==e)i+='<span class="curr">'+r[s]+"</span>";else i+='<a title="第'+r[s]+'页" href="#">'+r[s]+"</a>"}if(r.length>=t)return i;if(e+a/2>=t)return"<span>...</span>"+i;else if(e<parseInt(a/2))return i+"<span>...</span>";else return"<span>...</span>"+i+"<span>...</span>"});Handlebars.registerHelper("isDisable",function(e,t){if(e==t)return"disabled"});var i={init:function(t){if(t.Code!=0)return;if(!t.Result.gradeRecordList||!t.Result.gradeRecordList.length)return;var n=a(t.Result),r=e("#comment"),i=e(".newest"),s=e("#newestComment"),o=e(".normal"),l=this;if(t.Result.Count.TotalCount)r.html(n);if(t.Result.Count.TotalCount)this.renderScore(t.Result.Count);i.hide();o.click(function(){e(this).addClass("selected").siblings("li").removeClass("selected");r.show();s.hide()});r.on("click",".pagination a",function(t){t.preventDefault();var n=e(this).html(),i=r.find(".curr");l.getData(l.productid,n,l.pageSize,function(e){var t=a(e.Result);r.html(t)})});r.on("click",".pagination_btn_go",function(){var e=r.find(".pagination_btn_go_input"),t=e.val(),n=e.data("cur"),i=e.data("total");if(t==n||t>i||t=="")return;l.getData(l.productid,t,l.pageSize,function(e){var t=a(e.Result);r.html(t)})});r.on("click",".nextPage:not(.disabled)",function(){var e=r.find(".curr"),t=parseInt(e.html())+1;l.getData(l.productid,t,l.pageSize,function(e){var t=a(e.Result);r.html(t)})});r.on("click",".prePage:not(.disabled)",function(){var e=r.find(".curr"),t=parseInt(e.html())-1;l.getData(l.productid,t,l.pageSize,function(e){var t=a(e.Result);r.html(t)})})},renderComment:function(){},sortByDate:function(e){e.sort(function(e,t){var a=e.createDate,n=t.createDate,r=a.split("-"),i=n.split("-"),s=new Date(r[0],r[1],r[2]),o=new Date(i[0],i[1],i[2]);return s>o?0:1});return e},page:function(e,t,a){},renderScore:function(t){var a=r(t);e(".detail-comment").find(".info").html(a)},getData:function(t,a,n,r){i.productid=t,i.pageSize=n;e.ajax(baseConfig.base+baseConfig.tour_comment_url,{data:'{"productid":"'+t+'","page":'+a+',"pagesize":'+n+"}",method:"post"}).done(function(e){if(r)r(e)}).error(function(){})}};module.exports=i});